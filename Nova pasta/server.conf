##
## WARNING:
## This file was automatically generated and is actively maintained by cloudez.
## While it can still be managed manually, it is definitely not recommended. Please
## use the cloudez's web interface to manage this file and its respective services.
##
map $sent_http_content_type $expires_app342703 {
    default                    off;
    text/html                  epoch;
    text/css                   max;
    application/javascript     max;
    application/x-font-ttf     max;
    font/woff2                 max;
    application/font-woff      max;
    application/x-javascript   max;
    ~image/                    max;
    application/json           max;

}


limit_req_zone $binary_remote_addr zone=xmlrpc_app342703:10m rate=10r/m;
limit_req_zone $binary_remote_addr zone=login_app342703:10m rate=10r/m;
include /srv/app158.2d387ed1.configr.cloud/etc/nginx/rate-limit.conf;

server {
    
    server_name danielrobertomucheroni.siteup.dev www.danielrobertomucheroni.siteup.dev app158.2d387ed1.configr.cloud;
    
    listen 80;
    listen [::]:80;
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    location /.cez-verify/d33fe0f3ef999663e61a67818575a4069a95200790bdb0bfa65cc743 {
        default_type text/plain;
        return 200 "d33fe0f3ef999663e61a67818575a4069a95200790bdb0bfa65cc743";
    }

    location ~* /.well-known/acme-challenge/(.+) {
        auth_basic off;
        resolver 8.8.8.8 1.1.1.1;
        proxy_pass https://cert.cloudez.io/validate_token/$1;
    }

    location = /favicon.ico {
        root /srv/app158.2d387ed1.configr.cloud/www;
        try_files $uri $uri/ =404;
    }

    ## fix mixed-content
    sub_filter_types text/html application/javascript text/css application/x-javascript;
    sub_filter 'http://www.$host' '$scheme://www.$host';
    sub_filter 'http://$host' '$scheme://$host';
    sub_filter 'http:\/\/$host' '$scheme:\/\/$host';
    sub_filter 'http://webapp342703.ip-45-56-126-209.cloudezapp.io' '$scheme://$host';
    sub_filter_once off;
    sub_filter_last_modified on;
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options nosniff;

    ## ssl certificate
    include /srv/ip-45-56-126-209.cloudezapp.io/etc/nginx/ssl_options.conf;
    include /srv/app158.2d387ed1.configr.cloud/etc/nginx/domain_ssl.conf;


    ## security headers
    add_header Access-Control-Allow-Origin '*';
    add_header 'X-Cloudez-Verify' 'd33fe0f3ef999663e61a67818575a4069a95200790bdb0bfa65cc743';

    ## per-site config
    include /srv/app158.2d387ed1.configr.cloud/etc/nginx/conf.d/*.conf;

    ## custom error pages
    include /etc/nginx/error_pages.conf;

    ## canonical domain
    include /srv/ip-45-56-126-209.cloudezapp.io/etc/nginx/canonical_domain.conf;

    ## security rules
    include /srv/ip-45-56-126-209.cloudezapp.io/etc/nginx/security_rules.conf;

    ## gzip compression
    include /srv/ip-45-56-126-209.cloudezapp.io/etc/nginx/gzip_compression.conf;

    ## upload maxsize
    client_max_body_size 50M;
    client_body_buffer_size 512k;

    ## logging
    error_log /srv/app158.2d387ed1.configr.cloud/log/nginx/error.log;
    access_log /srv/app158.2d387ed1.configr.cloud/log/nginx/access.log main;



    ## prevent Duplicator exploit
    if ( $query_string ~* file=/../wp-config.php ) {
        return 403;
    }

    location ~* /(?:uploads|files)/.*\.php$ {
        deny all;
    }

    # WP File Manager Exploit
    location ~* /wp-content/plugins/wp-file-manager/lib/files {
        deny all;
    }

    location ~* /wp-content/uploads/wpcf7_uploads/ {
        deny all;
    }

    location = /xmlrpc.php {
        #contenttools
        allow 52.9.47.198;
        allow 52.8.70.193;
        allow 52.8.57.121;
        #wordfence
        allow 69.46.36.0/27;
        allow 204.194.222.0/23;
        #Automattic
        allow 192.0.64.0/18;
        deny all;
        proxy_set_header Host $host;
        proxy_set_header COUNTRY_CODE $geoip2_data_country_code;
        proxy_set_header COUNTRY_NAME $geoip2_data_country_name;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_pass $scheme://127.0.0.1:$custom_port;
    }

    location = /wp-login.php {
        include /srv/app158.2d387ed1.configr.cloud/etc/nginx/wp-login[.]conf;
        limit_req zone=login_app342703 burst=5 nodelay;
        limit_req zone=country_app342703 burst=5 nodelay;
        try_files /dev/null @backend_app342703;
    }

    location / {
        try_files /dev/null @backend_app342703;
    }

    location ~* \.(ico|gif|jpg|jpeg|png|webp|css|swf|bmp|woff|woff2|gz|eot|svg|svgz|mp4|ogg|ogv|webm|htc|ttf|js|zip|txt|xml|flv|pdf|avi|mov|ppt|doc|mp3|wmv|wav|m4v|aac|otf|cur)$ {
        root /srv/app158.2d387ed1.configr.cloud/www;
        add_header Cache-Control "public";
        add_header Pragma "public";
        add_header Access-Control-Allow-Origin '*';
        expires max;

        try_files $uri @backend_app342703;
    }
      
    location @backend_app342703 {
        proxy_request_buffering off;
        proxy_set_header Host $host;
        proxy_set_header COUNTRY_CODE $geoip2_data_country_code;
        proxy_set_header COUNTRY_NAME $geoip2_data_country_name;
        proxy_set_header Accept-Encoding "";
        proxy_read_timeout 300;
        proxy_send_timeout 300;
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_pass $scheme://127.0.0.1:$custom_port;
        # wss support
        include /srv/app158.2d387ed1.configr.cloud/etc/nginx/wss[.]conf;
    }

    expires $expires_app342703;
}

server {
    server_name webapp342703.ip-45-56-126-209.cloudezapp.io;
    listen 80;
    listen [::]:80;
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    ## disable search engine indexing
    location = /robots.txt {
      default_type text/plain;
      return 200 "User-agent: *\nDisallow: /";
    }

    ## security headers
    add_header Access-Control-Allow-Origin '*';
    add_header 'X-Cloudez-Verify' 'd33fe0f3ef999663e61a67818575a4069a95200790bdb0bfa65cc743';

    ## per-site config
    include /srv/app158.2d387ed1.configr.cloud/etc/nginx/conf.d/*.conf;

    ## custom error pages
    include /etc/nginx/error_pages.conf;

    ## canonical domain
    include /srv/ip-45-56-126-209.cloudezapp.io/etc/nginx/canonical_domain.conf;

    ## security rules
    include /srv/ip-45-56-126-209.cloudezapp.io/etc/nginx/security_rules.conf;

    ## gzip compression
    include /srv/ip-45-56-126-209.cloudezapp.io/etc/nginx/gzip_compression.conf;

    ## upload maxsize
    client_max_body_size 50M;
    client_body_buffer_size 512k;

    ## logging
    error_log /srv/app158.2d387ed1.configr.cloud/log/nginx/error.log;
    access_log /srv/app158.2d387ed1.configr.cloud/log/nginx/access.log main;

    
    ## ssl certificates
    include /srv/ip-45-56-126-209.cloudezapp.io/etc/nginx/ssl_options.conf;
    ssl_certificate /srv/ip-45-56-126-209.cloudezapp.io/etc/ssl/certs/ip-45-56-126-209.cloudezapp.io.crt;
    ssl_certificate_key /srv/ip-45-56-126-209.cloudezapp.io/etc/ssl/certs/ip-45-56-126-209.cloudezapp.io.key;



    ## prevent Duplicator exploit
    if ( $query_string ~* file=/../wp-config.php ) {
        return 403;
    }

    location ~* /(?:uploads|files)/.*\.php$ {
        deny all;
    }

    # WP File Manager Exploit
    location ~* /wp-content/plugins/wp-file-manager/lib/files {
        deny all;
    }

    location ~* /wp-content/uploads/wpcf7_uploads/ {
        deny all;
    }


    location = /xmlrpc.php {
        #contenttools
        allow 52.9.47.198;
        allow 52.8.70.193;
        allow 52.8.57.121;
        #wordfence
        allow 69.46.36.0/27;
        allow 204.194.222.0/23;
        #Automattic
        allow 192.0.64.0/18;
        deny all;
        proxy_set_header Host $host;
        proxy_set_header COUNTRY_CODE $geoip2_data_country_code;
        proxy_set_header COUNTRY_NAME $geoip2_data_country_name;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_pass $scheme://127.0.0.1:$custom_port;
    }

    location = /wp-login.php {
        include /srv/app158.2d387ed1.configr.cloud/etc/nginx/wp-login[.]conf;
        limit_req zone=login_app342703 burst=5 nodelay;
        limit_req zone=country_app342703 burst=5 nodelay;
        try_files /dev/null @backend_app342703;
    }

    location / {
        try_files /dev/null @backend_app342703;
    }

    location ~* \.(ico|gif|jpg|jpeg|png|webp|css|swf|bmp|woff|woff2|gz|eot|svg|svgz|mp4|ogg|ogv|webm|htc|ttf|js|zip|txt|xml|flv|pdf|avi|mov|ppt|doc|mp3|wmv|wav|m4v|aac|otf|cur)$ {
        root /srv/app158.2d387ed1.configr.cloud/www;
        add_header Cache-Control "public";
        add_header Pragma "public";
        add_header Access-Control-Allow-Origin '*';
        expires max;

        try_files $uri @backend_app342703;
    }
      
    location @backend_app342703 {
        proxy_request_buffering off;
        proxy_set_header Host $host;
        proxy_set_header COUNTRY_CODE $geoip2_data_country_code;
        proxy_set_header COUNTRY_NAME $geoip2_data_country_name;
        proxy_read_timeout 300;
        proxy_send_timeout 300;
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_pass $scheme://127.0.0.1:$custom_port;
        # wss support
        include /srv/app158.2d387ed1.configr.cloud/etc/nginx/wss[.]conf;
    }
    
    expires $expires_app342703;
}
